!function(o){o.isScrollToFixed=function(i){return!!o(i).data("ScrollToFixed")},o.ScrollToFixed=function(i,e){function t(){v.trigger("preUnfixed.ScrollToFixed"),x(),v.trigger("unfixed.ScrollToFixed"),C=-1,U=v.offset().top,z=v.offset().left,F.options.offsets&&(z+=v.offset().left-v.position().left),-1==A&&(A=z),T=v.css("position"),w=!0,-1!=F.options.bottom&&(v.trigger("preFixed.ScrollToFixed"),d(),v.trigger("fixed.ScrollToFixed"))}function n(){var o=F.options.limit;return o?"function"==typeof o?o.apply(v):o:0}function s(){return"fixed"===T}function l(){return"absolute"===T}function r(){return!(s()||l())}function d(){if(!s()){var o=v[0].getBoundingClientRect();O.css({display:v.css("display"),width:o.width,height:o.height,"float":v.css("float")}),cssOptions={"z-index":F.options.zIndex,position:"fixed",top:-1==F.options.bottom?f():"",bottom:-1==F.options.bottom?"":F.options.bottom,"margin-left":"0px"},F.options.dontSetWidth||(cssOptions.width=v.css("width")),v.css(cssOptions),v.addClass(F.options.baseClassName),F.options.className&&v.addClass(F.options.className),T="fixed"}}function c(){var o=n(),i=z;F.options.removeOffsets&&(i="",o-=U),cssOptions={position:"absolute",top:o,left:i,"margin-left":"0px",bottom:""},F.options.dontSetWidth||(cssOptions.width=v.css("width")),v.css(cssOptions),T="absolute"}function x(){r()||(C=-1,O.css("display","none"),v.css({"z-index":m,width:"",position:S,left:"",top:h,"margin-left":""}),v.removeClass("scroll-to-fixed-fixed"),F.options.className&&v.removeClass(F.options.className),T=null)}function p(o){o!=C&&(v.css("left",z-o),C=o)}function f(){var o=F.options.marginTop;return o?"function"==typeof o?o.apply(v):o:0}function u(){if(o.isScrollToFixed(v)&&!v.is(":hidden")){var i=w,e=r();w?r()&&(U=v.offset().top,z=v.offset().left):t();var u=o(window).scrollLeft(),T=o(window).scrollTop(),b=n();F.options.minWidth&&o(window).width()<F.options.minWidth?r()&&i||(g(),v.trigger("preUnfixed.ScrollToFixed"),x(),v.trigger("unfixed.ScrollToFixed")):F.options.maxWidth&&o(window).width()>F.options.maxWidth?r()&&i||(g(),v.trigger("preUnfixed.ScrollToFixed"),x(),v.trigger("unfixed.ScrollToFixed")):F.options.minHeight&&o(window).height()<F.options.minHeight?r()&&i||(g(),v.trigger("preUnfixed.ScrollToFixed"),x(),v.trigger("unfixed.ScrollToFixed")):F.options.maxHeight&&o(window).height()>F.options.maxHeight?r()&&i||(g(),v.trigger("preUnfixed.ScrollToFixed"),x(),v.trigger("unfixed.ScrollToFixed")):-1==F.options.bottom?b>0&&T>=b-f()?e||l()&&i||(g(),v.trigger("preAbsolute.ScrollToFixed"),c(),v.trigger("unfixed.ScrollToFixed")):T>=U-f()?(s()&&i||(g(),v.trigger("preFixed.ScrollToFixed"),d(),C=-1,v.trigger("fixed.ScrollToFixed")),p(u)):r()&&i||(g(),v.trigger("preUnfixed.ScrollToFixed"),x(),v.trigger("unfixed.ScrollToFixed")):b>0?T+o(window).height()-v.outerHeight(!0)>=b-(f()||-a())?s()&&(g(),v.trigger("preUnfixed.ScrollToFixed"),"absolute"===S?c():x(),v.trigger("unfixed.ScrollToFixed")):(s()||(g(),v.trigger("preFixed.ScrollToFixed"),d()),p(u),v.trigger("fixed.ScrollToFixed")):p(u)}}function a(){return F.options.bottom?F.options.bottom:0}function g(){var o=v.css("position");v.trigger("absolute"==o?"postAbsolute.ScrollToFixed":"fixed"==o?"postFixed.ScrollToFixed":"postUnfixed.ScrollToFixed")}var F=this;F.$el=o(i),F.el=i,F.$el.data("ScrollToFixed",F);var T,S,b,h,m,w=!1,v=F.$el,U=0,z=0,A=-1,C=-1,O=null,y=function(){v.is(":visible")&&(w=!1,u())},N=function(){window.requestAnimationFrame?requestAnimationFrame(u):u()},W=function(o){o=o||window.event,o.preventDefault&&o.preventDefault(),o.returnValue=!1};F.init=function(){F.options=o.extend({},o.ScrollToFixed.defaultOptions,e),m=v.css("z-index"),F.$el.css("z-index",F.options.zIndex),O=o("<div />"),T=v.css("position"),S=v.css("position"),b=v.css("float"),h=v.css("top"),r()&&F.$el.after(O),o(window).bind("resize.ScrollToFixed",y),o(window).bind("scroll.ScrollToFixed",N),"ontouchmove"in window&&o(window).bind("touchmove.ScrollToFixed",u),F.options.preFixed&&v.bind("preFixed.ScrollToFixed",F.options.preFixed),F.options.postFixed&&v.bind("postFixed.ScrollToFixed",F.options.postFixed),F.options.preUnfixed&&v.bind("preUnfixed.ScrollToFixed",F.options.preUnfixed),F.options.postUnfixed&&v.bind("postUnfixed.ScrollToFixed",F.options.postUnfixed),F.options.preAbsolute&&v.bind("preAbsolute.ScrollToFixed",F.options.preAbsolute),F.options.postAbsolute&&v.bind("postAbsolute.ScrollToFixed",F.options.postAbsolute),F.options.fixed&&v.bind("fixed.ScrollToFixed",F.options.fixed),F.options.unfixed&&v.bind("unfixed.ScrollToFixed",F.options.unfixed),F.options.spacerClass&&O.addClass(F.options.spacerClass),v.bind("resize.ScrollToFixed",function(){O.height(v.height())}),v.bind("scroll.ScrollToFixed",function(){v.trigger("preUnfixed.ScrollToFixed"),x(),v.trigger("unfixed.ScrollToFixed"),u()}),v.bind("detach.ScrollToFixed",function(i){W(i),v.trigger("preUnfixed.ScrollToFixed"),x(),v.trigger("unfixed.ScrollToFixed"),o(window).unbind("resize.ScrollToFixed",y),o(window).unbind("scroll.ScrollToFixed",N),v.unbind(".ScrollToFixed"),O.remove(),F.$el.removeData("ScrollToFixed")}),y()},F.init()},o.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"},o.fn.scrollToFixed=function(i){return this.each(function(){new o.ScrollToFixed(this,i)})}}(jQuery);